# Nov 8 — Build Plan for Basic Social Features\n\nThis is the execution checklist for what’s described in `documentation/social-features.md`.\n\n## 0) Prep\n- Confirm Supabase CLI login and links for dev/prod.\n- Ensure local env uses dev Supabase; Vercel Production uses prod Supabase.\n\n## 1) Database schema (Supabase migrations)\n1. Create `profiles` (1:1 with `auth.users`).\n   - Columns: `id (pk, uuid)`, `username (unique, ci)`, `display_name`, `bio`, `avatar_url`, timestamps.\n   - RLS: public SELECT; INSERT/UPDATE self only.\n   - Index: `unique on lower(username)`.\n2. Create `follows` (directed relation).\n   - Columns: `follower_id`, `following_id`, `created_at`.\n   - Constraints: `unique(follower_id, following_id)`, `check(follower_id <> following_id)`.\n   - Indexes: by follower and by following.\n   - RLS: public SELECT; INSERT/DELETE where `auth.uid() = follower_id`.\n3. Create `posts` (feed items).\n   - Columns: `id`, `user_id`, `type`, `openalex_id?`, `status?`, `rating?`, `note?`, `created_at`.\n   - Indexes: `(user_id, created_at desc)`, `(openalex_id)`.\n   - RLS: public SELECT; INSERT where `auth.uid() = user_id`.\n4. Tighten `user_papers.status` values.\n   - CHECK `status in ('to_read','reading','read')`; default `to_read`.\n5. Push to dev, verify, then push to prod.\n\n## 2) Profile essentials\n1. Auto‑create profile row on first auth (client upsert by `id`).\n2. Page: `/profile` (private)\n   - Fields: `username` (unique), `display_name`, `bio`, `avatar_url`.\n   - Validate username (regex + availability using `lower(username)`).\n3. Navbar: add “Profile” when signed in.\n\n## 3) Public profiles\n1. Page: `/u/[username]`\n   - Load profile by `username`.\n   - Show avatar/name/bio.\n   - Show follower/following counts (HEAD selects with counts).\n   - Follow/Unfollow button (disabled for self). Optimistic toggle.\n2. Show user’s Library\n   - Query `user_papers` → `papers` filtered by that user’s `id`, ordered by `inserted_at desc`.\n   - Add simple tabs/filters for `to_read`, `reading`, `read` (client‑side where clause).\n\n## 4) Feed (following → updates)\n1. Page: `/feed` (private)\n   - Query latest `posts` from people I follow (plus my own if desired), ordered desc, limit/paginate.\n   - Card types for MVP: “added to library”, “status changed”.\n2. Write posts on events\n   - When user adds a paper → insert `posts { type: 'added_to_library', openalex_id }`.\n   - When status changes → insert `posts { type: 'status_changed', openalex_id, status }`.\n\n## 5) Polish + UX\n- Display compact paper metadata chips (authors/year/source) in profile and feed.\n- Empty states for profile library and feed.\n- Disable buttons during network requests; toast on errors.\n\n## 6) QA checklist\n- RLS: cannot edit another user’s profile; follow/unfollow constrained to self.\n- Unique usernames enforced case‑insensitively.\n- Feed shows only followed users’ posts; profile pages are public.\n- Status filter properly scopes `user_papers`.\n\n## 7) Rollout\n- Dev: CLI `db push`, test all pages, seed a couple of users.\n- Prod: `db push`, deploy app, verify auth + profiles + follows + feed.\n- Add links in navbar to `/feed` (optional in MVP) and `/profile`.\n\n## 8) Nice‑to‑have (after MVP)\n- Reserved usernames blocklist; avatar upload via Supabase Storage.\n- Pagination/infinite scroll for feed and libraries.\n- Notifications and likes/comments on posts.\n- Private accounts + follow requests.\n*** End Patch

